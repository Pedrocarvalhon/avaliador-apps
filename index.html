<script>
  window.onload = () => {
    let saldo = Number(localStorage.getItem('saldo')) || 0;
    let ativado = localStorage.getItem('ativado') === 'true';
    const perguntas = {
      tiktok: [
        "Voc√™ achou o app f√°cil de usar?",
        "O conte√∫do era interessante?",
        "Voc√™ recomendaria o TikTok a um amigo?"
      ],
      kwai: [
        "O app foi r√°pido para carregar?",
        "Voc√™ achou o layout agrad√°vel?",
        "Os v√≠deos eram divertidos?"
      ],
      instagram: [
        "Voc√™ teve alguma dificuldade de navega√ß√£o?",
        "Achou √∫til para se conectar com amigos?",
        "Gostou das fun√ß√µes de stories e reels?"
      ]
    };

    function atualizarTela() {
      if (ativado) {
        document.getElementById('ativacaoBox').classList.add('hidden');
        document.getElementById('conteudo').classList.remove('hidden');
        document.getElementById('saldoBox').classList.remove('hidden');
        document.getElementById('resgateBox').classList.remove('hidden');
        document.getElementById('saldo').textContent = 'R$' + saldo;
      }
    }

    function ativarConta() {
      const nome = document.getElementById('pixComprovante').value.trim();
      if (nome.length > 2) {
        localStorage.setItem('ativado', 'true');
        ativado = true;
        atualizarTela();
        alert('‚úÖ Conta ativada com sucesso!');
      } else {
        alert('‚ùå Digite o nome de quem fez o Pix.');
      }
    }

    function mostrarPerguntas() {
      const app = document.getElementById('appSelect').value;
      const perguntasBox = document.getElementById('perguntasBox');
      const confirmarBtn = document.getElementById('confirmarBtn');
      perguntasBox.innerHTML = '';
      confirmarBtn.disabled = true;

      if (app) {
        document.getElementById('formulario').classList.remove('hidden');
        perguntas[app].forEach((pergunta, i) => {
          perguntasBox.innerHTML += `
            <label>${pergunta}</label>
            <select id="resp${i}">
              <option value="">-- Selecione --</option>
              <option value="sim">Sim</option>
              <option value="nao">N√£o</option>
            </select><br><br>
          `;
        });

        // Adiciona listeners depois que os <select> foram inseridos
        perguntas[app].forEach((_, i) => {
          document.getElementById(`resp${i}`).addEventListener('change', verificarRespostas);
        });
      } else {
        document.getElementById('formulario').classList.add('hidden');
      }
    }

    function verificarRespostas() {
      const app = document.getElementById('appSelect').value;
      let todasRespondidas = true;
      perguntas[app].forEach((_, i) => {
        const valor = document.getElementById(`resp${i}`).value;
        if (valor === "") todasRespondidas = false;
      });
      document.getElementById('confirmarBtn').disabled = !todasRespondidas;
    }

    function finalizarAvaliacao() {
      saldo += 25;
      localStorage.setItem('saldo', saldo);
      document.getElementById('saldo').textContent = 'R$' + saldo;
      document.getElementById('aviso').textContent = 'üéâ Voc√™ ganhou R$25!';
      document.getElementById('formulario').classList.add('hidden');
      document.getElementById('appSelect').value = '';
      setTimeout(() => {
        document.getElementById('aviso').textContent = '';
      }, 3000);
    }

    function resgatar() {
      const chave = document.getElementById('chavePix').value.trim();
      if (chave.length > 5 && saldo >= 25) {
        document.getElementById('resgateMsg').textContent = `‚úÖ Voc√™ ir√° receber R$${saldo} na chave Pix: ${chave}`;
        saldo = 0;
        localStorage.setItem('saldo', saldo);
        document.getElementById('saldo').textContent = 'R$0';
      } else {
        document.getElementById('resgateMsg').textContent = '‚ùå Preencha a chave Pix corretamente e tenha pelo menos R$25 de saldo!';
      }
    }

    atualizarTela();

    // Torna fun√ß√µes globais para os bot√µes
    window.ativarConta = ativarConta;
    window.mostrarPerguntas = mostrarPerguntas;
    window.finalizarAvaliacao = finalizarAvaliacao;
    window.resgatar = resgatar;
  };
</script>


